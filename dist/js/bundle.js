(()=>{var L=class{constructor(e){this._divElement=e,this._divElement.innerHTML="",this._lines=[],this._maxLines=30}log(...e){if(e.length==0)return;let t=Array.prototype.slice.call(e).join(" ");console.log(t),this._pushText(t)}error(...e){if(e.length==0)return;let t=Array.prototype.slice.call(e).join(" ");console.error(t),this._pushText("[ERR] - ".concat(t))}_pushText(e){this._lines.push(e),this._lines.length>this._maxLines&&this._lines.splice(0,this._lines.length-this._maxLines),this._divElement.innerHTML=this._lines.map(t=>/^(\[JS\]).*$/.test(t)?'<span style="color: rgb(200,200,150);">'.concat(t,"</span>"):/^(\[C\+\+\]).*$/.test(t)?'<span style="color: rgb(150,150,200);">'.concat(t,"</span>"):t).join("<br>"),this._divElement.scrollTop=this._divElement.scrollHeight}get size(){return this._lines.length}peekLast(){if(this._lines.length>0)return this._lines[this._lines.length-1]}popLast(){this._lines.length>0&&this._lines.splice(this._lines.length-1,1)}},C=L;var F=/[?&]+([^=&]+)=([^&]*)/gi,T=()=>{let n={},e=null;for(;e=F.exec(window.location.href);){let t=e[1],o=e[2];n[t]=o}return n};var W=n=>new Promise((e,t)=>{let o=document.createElement("script");o.src=n,o.addEventListener("load",()=>e),o.addEventListener("error",t),document.head.appendChild(o)});var S=n=>{if(!window.WebGL2RenderingContext)throw new Error("missing WebGL2 feature (unsuported)");let e={alpha:!1,antialias:!1,depth:!0,failIfMajorPerformanceCaveat:!1,powerPreference:"high-performance",premultipliedAlpha:!0,preserveDrawingBuffer:!0,stencil:!1},t=n.getContext("webgl2",e);if(!t){let o="WebGL2 context failed (initialisation)";throw new Error(o)}return t};var G=()=>(()=>{try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"){let e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e)instanceof WebAssembly.Instance}}catch(e){}return!1})();var $=()=>!!window.Worker;var k=()=>!!window.WebGL2RenderingContext;var H=()=>{let n=window.SharedArrayBuffer!==void 0;if(n){let t={initial:8,maximum:8,shared:!0};if(!(new WebAssembly.Memory(t).buffer instanceof SharedArrayBuffer))return!1}return n};var x=class{constructor(e,t,o){this._width=800;this._height=600;this._isInitialized=!1;this._isAborted=!1;this._canvas=e,this._onProgress=t,this._onError=o}async initialize(e,t,o,w,s){if(this._width=e,this._height=t,!$())throw new Error("missing WebWorker feature (unsupported)");if(s.log("[JS][check] WebWorker feature => supported"),!G())throw new Error("missing WebAssembly feature (unsupported)");s.log("[JS][check] WebAssembly feature => supported");let l=H();if(l?s.log("[JS][check] multithreading => supported"):(s.log("[JS][check] multithreading => NOT supported"),s.log("[JS][check] => falling back to the webworker version")),!k())throw new Error("missing WebGL2 feature (unsupported)");s.log("[JS][check] WebGL2 feature => supported");let u=()=>{this._isAborted=!0,this._onError&&this._onError("Could not create a WebGL2 context.")};this._canvas.addEventListener("webglcontextcreationerror",u,!1);let g=()=>{this._isAborted=!0,this._onError&&this._onError("WebGL2 context lost. You will need to reload the page.")};this._canvas.addEventListener("webglcontextlost",g,!1);let _=b=>{b.preventDefault()};this._canvas.addEventListener("contextmenu",_,!1),this._webglCtx=S(this._canvas),s.log("[JS] WebGL2 context initialized");let p="wasm/".concat(l?"pthread":"webworker");return new Promise((b,y)=>{let m={downloadingDataRegExp:/Downloading data\.\.\. \(([0-9]*)\/([0-9]*)\)/,lastProgressLevel:0,locateFile:i=>"".concat(p,"/").concat(i),print:i=>{s.log("[C++][out] ".concat(i))},printErr:i=>{s.error("[C++][err] ".concat(i))},setStatus:i=>{if(!i)return;let d=m.downloadingDataRegExp.exec(i);if(d){let c=parseFloat(d[1]),v=parseFloat(d[2]),f=Math.floor(c/v*100);m.lastProgressLevel!==f&&(m.lastProgressLevel=f,this._onProgress(f))}else s.log("[JS][wasm][status] ".concat(i))},onRuntimeInitialized:()=>{s.log("[JS][wasm] loaded"),s.log("[JS][wasm] initialising");let i={startApplication:window.Module.cwrap("startApplication",void 0,["number","number","number","number"]),updateApplication:window.Module.cwrap("updateApplication",void 0,["number"]),renderApplication:window.Module.cwrap("renderApplication",void 0,[])};this._wasmApplicationUpdateFunc=i.updateApplication,this._wasmApplicationRenderFunc=i.renderApplication,i.startApplication(this._width,this._height,o,w),this._isInitialized=!0,s.log("[JS][wasm] initialized"),b()},canvas:this._canvas,preinitializedWebGLContext:this._webglCtx,noInitialRun:!0,noExitRuntime:!0};window.Module=m,s.log("[JS][wasm] loading"),W("./".concat(p,"/index.js")).catch(y)})}update(e){!this._isInitialized||this._isAborted||this._wasmApplicationUpdateFunc&&this._wasmApplicationUpdateFunc(e)}render(){!this._isInitialized||this._isAborted||this._wasmApplicationRenderFunc&&this._wasmApplicationRenderFunc()}abort(){if(!this._isInitialized||this._isAborted)return;this._isAborted=!0;let e=window.Module;e&&(e.setStatus=t=>{t&&console.error("[JS][wasm][aborted] ".concat(t))})}};var h=n=>{let e=document.querySelector(n);if(!e)throw new Error("DOM elements not found, id=".concat(n));return e},J=async()=>{let n=!0,e=h("#loggerOutput"),t=new C(e);t.log("[JS] page loaded");let o=r=>{n=!1,t.error("[JS] exception, message=".concat(r.message))};window.addEventListener("error",o);let w=h("#errorText"),s=h("#renderArea"),l=h("#canvas"),u={switchTo3cpuCores:h("#try_with_3_cpu_cores"),switchTo6cpuCores:h("#try_with_6_cpu_cores")},g=r=>{r.style.display!=="none"&&(r.style.display="none")},_=r=>{r.style.display!=="block"&&(r.style.display="block")},p=r=>{w.innerHTML=r,g(l),_(w)},b=()=>{g(w),_(l)},y=(r,a)=>{s.style.width="".concat(r,"px"),s.style.height="".concat(a,"px"),l.width=r,l.height=a,l.style.width="".concat(r,"px"),l.style.height="".concat(a,"px")},m=r=>{o(r),p("fatal error, event=".concat(r))};window.removeEventListener("error",o),window.addEventListener("error",m);let i=(r,a)=>r?parseInt(r,10):a,d=T(),c={width:i(d.width,800),height:i(d.height,600),totalGenomes:i(d.totalGenomes,1e3),totalCores:i(d.totalCores,3)};y(c.width,c.height);let v=(r,a,R)=>{r.disabled=!1,r.classList.contains(a)||r.classList.add(a),r.classList.contains("grayButton")&&r.classList.remove("grayButton"),r.addEventListener("click",()=>{window.location.href=window.location.pathname+"?totalCores=".concat(R)})};c.totalCores!=3?(u.switchTo6cpuCores.disabled=!0,v(u.switchTo3cpuCores,"blueButton",3)):(u.switchTo3cpuCores.disabled=!0,v(u.switchTo6cpuCores,"redButton",6));let f=r=>{let a="Loading wasm [".concat(r,"%]");t.size>0&&t.peekLast().indexOf("Loading wasm [")>=0&&t.popLast(),t.log("[JS] ".concat(a)),p(a)},E=new x(l,f,p);try{await E.initialize(c.width,c.height,c.totalGenomes,c.totalCores,t),b()}catch(r){t.error('[JS] dependencies check failed: message="'.concat(r.message,'"')),p(["this browser isn't compatible","error message:","=> ".concat(r.message)].join("<br>"))}let A=Date.now(),M=()=>{n&&requestAnimationFrame(M);let r=Date.now(),a=r-A;A=r,E.update(a),E.render()};M()};window.addEventListener("load",J);})();
